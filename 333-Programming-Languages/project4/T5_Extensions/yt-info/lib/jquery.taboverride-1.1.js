/*!
 * Tab Override jQuery Plugin v1.1
 * http://wjbryant.com/projects/tab-override/
 *
 * Copyright (c) 2011 Bill Bryant
 * Licensed under the MIT license
 * http://opensource.org/licenses/mit-license.php
 */
jQuery.fn.tabOverride=function(a){function i(a){var b=a.keyCode;if((b===9||b===13&&g.autoIndent&&!c)&&!a.ctrlKey&&!a.altKey){a.preventDefault()}}function h(a){var d=a.keyCode,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(d!==9&&(d!==13||!g.autoIndent)||a.ctrlKey||a.altKey){return}c=false;j=this.value;o=this.scrollTop;if(document.selection){k=document.selection.createRange();r=k.text;l=k.duplicate();l.moveToElementText(this);l.setEndPoint("EndToEnd",k);q=l.text.length;p=q-r.length;if(f>1){m=j.slice(0,p).split(e).length-1;n=r.split(e).length-1}else{m=n=0}}else if(typeof this.selectionStart!=="undefined"){p=this.selectionStart;q=this.selectionEnd;r=j.slice(p,q)}else{return}if(d===9){h=b;i=h.length;u=0;v=0;w=0;if(p!==q&&r.indexOf("\n")!==-1){if(p===0||j.charAt(p-1)==="\n"){s=p}else{s=j.lastIndexOf("\n",p-1)+1}if(q===j.length||j.charAt(q)==="\n"){t=q}else{t=j.indexOf("\n",q);if(t===-1){t=j.length}}if(a.shiftKey){if(j.slice(s).indexOf(h)===0){if(s===p){r=r.slice(i)}else{w=i}v=i}this.value=j.slice(0,s)+j.slice(s+w,p)+r.replace(new RegExp("\n"+h,"g"),function(){u+=1;return"\n"})+j.slice(q);if(k){k.collapse();k.moveEnd("character",q-v-u*i-n-m);k.moveStart("character",p-w-m);k.select()}else{this.selectionStart=p-w;this.selectionEnd=q-v-u*i}}else{u=1;this.value=j.slice(0,s)+h+j.slice(s,p)+r.replace(/\n/g,function(){u+=1;return"\n"+h})+j.slice(q);if(k){k.collapse();k.moveEnd("character",q+u*i-n-m);k.moveStart("character",p+i-m);k.select()}else{this.selectionStart=p+i;this.selectionEnd=q+u*i;this.scrollTop=o}}}else{if(a.shiftKey){if(j.slice(p-i).indexOf(h)===0){this.value=j.slice(0,p-i)+j.slice(p);if(k){k.move("character",p-i-m);k.select()}else{this.selectionEnd=this.selectionStart=p-i;this.scrollTop=o}}}else{if(k){k.text=h;k.select()}else{this.value=j.slice(0,p)+h+j.slice(q);this.selectionEnd=this.selectionStart=p+i;this.scrollTop=o}}}}else if(g.autoIndent){if(p===0||j.charAt(p-1)==="\n"){c=true;return}else{s=j.lastIndexOf("\n",p-1)+1}t=j.indexOf("\n",p);if(t===-1){t=j.length}x=j.slice(s,t).match(/^[ \t]*/)[0];y=x.length;if(p<s+y){c=true;return}if(k){k.text="\n"+x;k.select()}else{this.value=j.slice(0,p)+"\n"+x+j.slice(q);this.selectionEnd=this.selectionStart=p+f+y;this.scrollTop=o}}a.preventDefault()}var b="\t",c=false,d=document.createElement("textarea"),e,f,g;g=function(b){this.each(function(){a(this).unbind(".tabOverride")});if(!arguments.length||b){this.each(function(){if(this.nodeName&&this.nodeName.toLowerCase()==="textarea"){a(this).bind("keydown.tabOverride",h).bind("keypress.tabOverride",i)}})}return this};g.getTabSize=function(){return b==="\t"?0:b.length};g.setTabSize=function(a){var c;if(!a){b="\t"}else if(typeof a==="number"&&a>0){b="";for(c=0;c<a;c+=1){b+=" "}}};g.autoIndent=false;d.value="\n";e=d.value;f=e.length;d=null;return g}(jQuery)